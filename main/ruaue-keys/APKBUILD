# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=ruaue-keys
pkgver=1
pkgrel=0
pkgdesc="Public keys for repo.vyos.eu.org packages"
url="https://repo.vyos.eu.org"
# we install arch specific keys to /etc so we cannot do arch=noarch
arch="all"
license="BSD-3-Clause"
options="!check"

_arch_keys="x86_64:apk@ruaue.com-65a20657.rsa.pub"

for _i in $_arch_keys; do
	source="$source ${_i#*:}"
done

_ins_key() {
	msg "- $2 ($1)"
	install -Dm644 "$srcdir"/$2 "$pkgdir"/etc/apk/keys/$2
}

_install_x86() {
	case "$1" in
	x86*) _ins_key $1 $2 ;;
	esac
}

package() {
	# copy keys for repos
	mkdir -p "$pkgdir"/etc/apk/keys
	for i in $_arch_keys; do
		_archs="${i%:*}"
		_key="${i#*:}"
		install -Dm644 "$srcdir"/$_key \
			"$pkgdir"/usr/share/apk/keys/$_key

		for _arch in ${_archs//,/ }; do
			mkdir -p "$pkgdir"/usr/share/apk/keys/$_arch
			ln -s ../$_key "$pkgdir"/usr/share/apk/keys/$_arch/

			case "$CARCH" in
			x86*) _install_x86 $_arch $_key ;;
			esac
		done
	done
}

sha512sums="
1699ca233203d9a60dc3dae25833ab4bee5828f534a6377de6cb1526279bc53ad012cc95bdcd13e723b18cff0722b25e52b25b6037f5e62d6b030b1132d38581  apk@ruaue.com-65a20657.rsa.pub
"
